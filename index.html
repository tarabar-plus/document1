<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <title>TarabarPlus - راهنمای کامل سیستم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vazir Font Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      @media print {
        .no-print {
          display: none !important;
        }
        body {
          margin: 0;
          font-family: "Vazirmatn", "vazir", sans-serif;
          padding: 20px;
        }
        .step-card {
          break-inside: avoid;
          page-break-inside: avoid;
        }
        .page-break {
          page-break-before: always;
        }
      }

      /* Apply Vazir font to entire page */
      * {
        font-family: "Vazirmatn", "vazir", sans-serif !important;
      }

      body {
        font-family: "Vazirmatn", "vazir", sans-serif !important;
      }

      .step-card {
        transition: all 0.3s ease;
        transform: scale(1);
        margin-bottom: 2rem;
        break-inside: avoid;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .step-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }
      .step-active {
        border-color: #3b82f6;
        background-color: #eff6ff;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Enhanced Mobile-First Image Styling */
      .image-container {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: transform 0.3s ease, border-color 0.3s ease;
        border: 2px solid #e2e8f0;
        touch-action: manipulation;
      }
      .image-container:hover {
        transform: scale(1.02);
        border-color: #3b82f6;
      }

      /* Mobile-optimized image sizes */
      .mobile-image {
        max-height: 180px;
        width: 100%;
        object-fit: cover;
        border-radius: 12px;
      }
      .web-image {
        max-height: 160px;
        width: 100%;
        object-fit: cover;
        border-radius: 12px;
      }
      .main-image {
        max-height: 220px;
        width: 100%;
        object-fit: cover;
        border-radius: 12px;
      }

      /* Responsive image grid */
      .step-image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
        margin-top: 1rem;
      }

      /* Mobile-specific zoom controls */
      .zoom-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        padding: 10px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        display: flex;
        gap: 0.5rem;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .zoom-btn {
        width: 44px;
        height: 44px;
        border: none;
        border-radius: 50%;
        background: #ffffff;
        color: #3b82f6;
        font-size: 18px;
        cursor: pointer;
        margin: 0 5px;
        transition: background 0.3s ease, color 0.3s ease;
        font-weight: bold;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }
      .zoom-btn:hover,
      .zoom-btn:active {
        background: #3b82f6;
        color: #ffffff;
        transform: scale(1.1);
      }

      /* Enhanced modal for mobile - Complete rewrite */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(10px);
        overflow: hidden;
      }

      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .modal-image {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        border: 3px solid #3b82f6;
        animation: modalFadeIn 0.3s ease-out;
        z-index: 10001;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      /* Close Button - Fixed positioning and styling */
      .modal-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        color: white;
        cursor: pointer;
        z-index: 10002;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        -webkit-tap-highlight-color: transparent;
      }

      .modal-close:hover,
      .modal-close:active {
        background: rgba(255, 0, 0, 0.8);
        border-color: rgba(255, 255, 255, 0.8);
        transform: scale(1.1);
      }

      /* Navigation Buttons - Fixed positioning and directions */
      .modal-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 60px;
        height: 60px;
        background: rgba(0, 0, 0, 0.6);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        color: white;
        cursor: pointer;
        z-index: 10002;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        -webkit-tap-highlight-color: transparent;
      }

      .modal-nav:hover,
      .modal-nav:active {
        background: rgba(59, 130, 246, 0.8);
        border-color: rgba(255, 255, 255, 0.8);
        transform: translateY(-50%) scale(1.1);
      }

      .modal-prev {
        left: 20px;
      }

      .modal-next {
        right: 20px;
      }

      /* Image Counter */
      .modal-counter {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        z-index: 10002;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      /* Image Info */
      .modal-info {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px 25px;
        border-radius: 25px;
        font-size: 14px;
        text-align: center;
        max-width: 90%;
        z-index: 10002;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .pdf-header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom-left-radius: 1rem;
        border-bottom-right-radius: 1rem;
      }
      .pdf-header h1 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        font-family: "Vazirmatn", "vazir", sans-serif !important;
      }
      .pdf-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        font-family: "Vazirmatn", "vazir", sans-serif !important;
      }

      /* Enhanced UI/UX Styles */
      .step-card {
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .step-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .step-card h2 {
        font-size: 1.75rem;
        color: #1e293b;
      }

      .step-card p {
        font-size: 1rem;
        line-height: 1.6;
        color: #475569;
      }

      .step-card span {
        font-size: 0.875rem;
        font-weight: bold;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
      }

      .image-container {
        border: 2px solid #e2e8f0;
        transition: border-color 0.3s ease;
      }
      .image-container:hover {
        border-color: #3b82f6;
      }

      .zoom-controls {
        display: flex;
        gap: 0.5rem;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .zoom-btn {
        background: #ffffff;
        color: #3b82f6;
        font-weight: bold;
        transition: background 0.3s ease, color 0.3s ease;
      }
      .zoom-btn:hover {
        background: #3b82f6;
        color: #ffffff;
      }

      .modal {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }

      .modal-content {
        border: 4px solid #3b82f6;
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Enhanced Mobile-First Responsive Design */
      @media (max-width: 768px) {
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
        }

        .step-card {
          padding: 1.25rem;
          margin-bottom: 1.5rem;
        }

        .step-card h2 {
          font-size: 1.4rem;
          line-height: 1.3;
        }

        .step-card p {
          font-size: 0.9rem;
          line-height: 1.5;
        }

        .pdf-header {
          padding: 1.5rem 1rem;
          margin-bottom: 1.5rem;
        }

        .pdf-header h1 {
          font-size: 1.8rem;
          line-height: 1.2;
        }

        .pdf-header p {
          font-size: 1rem;
        }

        /* Mobile-optimized image grid */
        .step-image-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 0.5rem;
        }

        /* Mobile image sizes */
        .mobile-image {
          max-height: 150px;
          width: 100%;
        }

        .web-image {
          max-height: 130px;
          width: 100%;
        }

        .main-image {
          max-height: 180px;
          width: 100%;
        }

        /* Mobile zoom controls */
        .zoom-controls {
          bottom: 15px;
          right: 15px;
          padding: 0.5rem 1rem;
        }

        .zoom-btn {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }

        /* Mobile modal improvements - Complete rewrite */
        .modal-image {
          max-width: 95%;
          max-height: 90%;
        }

        .modal-close {
          top: 15px;
          right: 15px;
          width: 45px;
          height: 45px;
        }

        .modal-nav {
          width: 50px;
          height: 50px;
        }

        .modal-prev {
          left: 15px;
        }

        .modal-next {
          right: 15px;
        }

        .modal-counter {
          top: 15px;
          left: 15px;
          padding: 10px 18px;
          font-size: 13px;
        }

        .modal-info {
          bottom: 15px;
          padding: 12px 20px;
          font-size: 13px;
        }
      }

      /* Extra small mobile devices */
      @media (max-width: 480px) {
        .container {
          padding-left: 0.75rem;
          padding-right: 0.75rem;
        }

        .step-card {
          padding: 1rem;
          margin-bottom: 1rem;
        }

        .step-card h2 {
          font-size: 1.25rem;
        }

        .step-card p {
          font-size: 0.85rem;
        }

        .pdf-header h1 {
          font-size: 1.5rem;
        }

        .step-image-grid {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
          gap: 0.4rem;
        }

        .mobile-image {
          max-height: 120px;
        }

        .web-image {
          max-height: 100px;
        }

        .main-image {
          max-height: 150px;
        }

        .zoom-controls {
          bottom: 10px;
          right: 10px;
          padding: 0.4rem 0.8rem;
        }

        .zoom-btn {
          width: 36px;
          height: 36px;
          font-size: 14px;
        }

        /* Extra small mobile modal optimizations */
        .modal-image {
          max-width: 98%;
          max-height: 85%;
        }

        .modal-close {
          top: 10px;
          right: 10px;
          width: 40px;
          height: 40px;
        }

        .modal-nav {
          width: 45px;
          height: 45px;
        }

        .modal-prev {
          left: 10px;
        }

        .modal-next {
          right: 10px;
        }

        .modal-counter {
          top: 10px;
          left: 10px;
          padding: 8px 15px;
          font-size: 12px;
        }

        .modal-info {
          bottom: 10px;
          padding: 10px 18px;
          font-size: 12px;
        }
      }

      /* Landscape mobile optimization */
      @media (max-width: 768px) and (orientation: landscape) {
        .pdf-header {
          padding: 1rem;
        }

        .pdf-header h1 {
          font-size: 1.6rem;
        }

        .step-card {
          padding: 1rem;
        }

        .step-card h2 {
          font-size: 1.3rem;
        }

        .step-image-grid {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }
      }

      /* Touch-friendly interactions */
      @media (hover: none) and (pointer: coarse) {
        .image-container:hover {
          transform: none;
        }

        .step-card:hover {
          transform: none;
        }

        .zoom-btn:hover {
          transform: none;
        }
      }

      /* High DPI displays */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .image-container {
          image-rendering: -webkit-optimize-contrast;
          image-rendering: crisp-edges;
        }
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-blue-50 to-indigo-100 font-sans rtl min-h-screen"
  >
    <!-- PDF Header -->
    <div class="pdf-header">
      <h1>راهنمای کامل فرآیند ثبت حواله در سیستم ترابر پلاس</h1>
      <!-- <p>راهنمای جامع استفاده از سیستم مدیریت حواله</p> -->
    </div>

    <!-- Main Content - Single Page Layout -->
    <main class="container mx-auto px-6 pb-8">
      <!-- Step 1: Landing Page -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-blue-200"
      >
        <div
          class="flex flex-col lg:flex-row items-start space-y-4 lg:space-y-0 lg:space-x-6 lg:space-x-reverse"
        >
          <div class="flex-1">
            <div class="flex items-center space-x-3 space-x-reverse mb-4">
              <span
                class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-bold"
                >مرحله ۱</span
              >
              <h2 class="text-2xl font-bold text-gray-800">صفحه اصلی سیستم</h2>
            </div>
            <p class="text-gray-600 mb-4 leading-relaxed">
              صفحه اصلی ترابر پلاس اولین نقطه تماس باربری ها با سامانه است. این
              صفحه شامل اطلاعات کلی، آمار سامانه و دسترسی سریع به بخش‌های مختلف
              می‌باشد. باربری ها می‌توانند از این صفحه به تمام بخش‌های سامانه
              دسترسی داشته باشند.
            </p>
          </div>
          <div class="flex-shrink-0 w-full lg:w-auto">
            <img
              src="./images/step_1.PNG"
              alt="صفحه اصلی سامانه"
              class="image-container main-image w-full"
              loading="lazy"
              onclick="openStepModal(1, 0)"
            />
          </div>
        </div>
      </div>

      <!-- Step 2: Login Form -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div
          class="flex flex-col lg:flex-row items-start space-y-4 lg:space-y-0 lg:space-x-6 lg:space-x-reverse"
        >
          <div class="flex-1">
            <div class="flex items-center space-x-3 space-x-reverse mb-4">
              <span
                class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold"
                >مرحله ۲</span
              >
              <h2 class="text-2xl font-bold text-gray-800">
                فرم ورود به سامانه
              </h2>
            </div>
            <p class="text-gray-600 mb-4 leading-relaxed">
              سامانه احراز هویت ترابر پلاس با استفاده از تکنولوژی‌های مدرن
              امنیتی طراحی شده است. باربری ها می‌توانند با نام کاربری و رمز عبور
              وارد سامانه شوند. این سامانه شامل محافظت‌های امنیتی پیشرفته و لاگ
              کامل فعالیت‌ها می‌باشد.
            </p>
          </div>
          <div class="flex-shrink-0 w-full lg:w-auto">
            <img
              src="./images/step_2.PNG"
              alt="فرم ورود به سامانه"
              class="image-container main-image w-full"
              loading="lazy"
              onclick="openStepModal(2, 0)"
            />
          </div>
        </div>
      </div>

      <!-- Step 3: Cargo Registration -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div class="mb-4">
          <div class="flex items-center space-x-3 space-x-reverse mb-4">
            <span
              class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold"
              >مرحله ۳</span
            >
            <h2 class="text-2xl font-bold text-gray-800">ثبت بار</h2>
          </div>
          <p class="text-gray-600 leading-relaxed">
            پس از ورود موفقیت آمیز کاربر (باربری) وارد قسمت ثبت بار شده و مشخصات
            بار را وارد می کند .پس از ثبت وارد قسمت تاریخچه بارها می‌شود و
            فعالسازی بار را وارد می‌کند (توجه: پس از فعالسازی است که راننده ها
            می‌توانند در پنل مربوطه در اپلیکیشن بار را مشاهده کنند.)
          </p>
        </div>

        <!-- Cargo Registration Images Grid -->
        <div class="step-image-grid">
          <img
            src="./images/step_3_1.PNG"
            alt="فرم ثبت بار قسمت اول"
            class="image-container web-image"
            loading="lazy"
            onclick="openStepModal(3, 0)"
          />
          <img
            src="./images/step_3_2.PNG"
            alt="فرم ثبت بار قسمت دوم"
            class="image-container web-image"
            loading="lazy"
            onclick="openStepModal(3, 1)"
          />
          <img
            src="./images/step_4_1.PNG"
            alt="تاریخچه بارها"
            class="image-container web-image"
            loading="lazy"
            onclick="openStepModal(3, 2)"
          />
          <img
            src="./images/step_4_2.PNG"
            alt="نحوه فعالسازی بار"
            class="image-container web-image"
            loading="lazy"
            onclick="openStepModal(3, 3)"
          />
        </div>
      </div>

      <!-- Step 4: Cargo History -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div
          class="flex flex-col lg:flex-row items-start space-y-4 lg:space-y-0 lg:space-x-6 lg:space-x-reverse"
        >
          <div class="flex-1">
            <div class="flex items-center space-x-3 space-x-reverse mb-4">
              <span
                class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold"
                >مرحله ۴</span
              >
              <h2 class="text-2xl font-bold text-gray-800">
                پنل موبایل راننده
              </h2>
            </div>
            <p class="text-gray-600 mb-4 leading-relaxed">
              پس از اعلام بار توسط باربری راننده وارد اپلکیشن ترابر پلاس می‌شود
              . و با انتخاب قسمت علام بار به سمت بارهای اعلامی هدایت می‌شود.
            </p>
          </div>
          <div class="flex-shrink-0 w-full lg:w-auto">
            <img
              src="./images/step_5_1.jpg"
              alt="پنل موبایل راننده"
              class="image-container main-image w-full"
              loading="lazy"
              onclick="openStepModal(4, 0)"
            />
          </div>
        </div>
      </div>

      <!-- Step 5: Mobile Dashboard -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div class="mb-4">
          <div class="flex items-center space-x-3 space-x-reverse mb-4">
            <span
              class="bg-teal-500 text-white px-3 py-1 rounded-full text-sm font-bold"
              >مرحله ۵</span
            >
            <h2 class="text-2xl font-bold text-gray-800">صفحه اعلام بارها</h2>
          </div>
          <p class="text-gray-600 leading-relaxed">
            در این بخش راننده با توجه به موقعیت چعرافیایی خود (این موقعیت توسط
            باربری تنظیم می‌شود ) بارهای اعلامی را مشاهده می‌کند. سپس انتخاب
            کرده و پس از آن با توجه به فاصله مبدا تا مقصد و همچنین افزودن زمان
            اضافه به راننده نشان داده می‌شود که تا مثلا ساعت ۱۰:۲۵ فردا شما
            نمی‌توانید بار رزرو کنید. پس از آن طی یک پیامک به راننده اعلام
            می‌شود که نوبت شما با موفقیت ثبت شد .در نهایت راننده می‌تواند بار
            رزرو شده را در تب سابقه بار ها ببیند.
          </p>
        </div>

        <!-- Mobile App Images Grid -->
        <div class="step-image-grid">
          <img
            src="./images/step_5_2.jpg"
            alt="داشبورد موبایل"
            class="image-container mobile-image"
            loading="lazy"
            onclick="openStepModal(5, 0)"
          />
          <img
            src="./images/step_5_3.jpg"
            alt="تنظیمات موبایل"
            class="image-container mobile-image"
            loading="lazy"
            onclick="openStepModal(5, 1)"
          />
          <img
            src="./images/step_5_2_1.jpg"
            alt="پروفایل موبایل"
            class="image-container mobile-image"
            loading="lazy"
            onclick="openStepModal(5, 2)"
          />
          <img
            src="./images/step_5_4.jpg"
            alt="اعلان‌های موبایل"
            class="image-container mobile-image"
            loading="lazy"
            onclick="openStepModal(5, 3)"
          />
        </div>
      </div>

      <!-- Step 6: Mobile Cargo Details -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div
          class="flex flex-col lg:flex-row items-start space-y-4 lg:space-y-0 lg:space-x-6 lg:space-x-reverse"
        >
          <div class="flex-1">
            <div class="flex items-center space-x-3 space-x-reverse mb-4">
              <span
                class="bg-pink-500 text-white px-3 py-1 rounded-full text-sm font-bold"
                >مرحله ۶</span
              >
              <h2 class="text-2xl font-bold text-gray-800">
                مشاهده راننده های ثبت‌نامی
              </h2>
            </div>
            <p class="text-gray-600 mb-4 leading-relaxed">
              پس از ثبت نوبت و رزرو بار توسط راننده ,باربری می‌تواند لیست راننده
              های ثبت‌نامی را دیده و آنهایی که رسیده‌اند را تایید کند و برای
              حواله چاپ کند .
            </p>
          </div>
          <div class="flex-shrink-0 w-full lg:w-auto">
            <img
              src="./images/step_6_1.PNG"
              alt="جزئیات بار و اعلان‌ها"
              class="image-container main-image w-full"
              loading="lazy"
              onclick="openStepModal(6, 0)"
            />
          </div>
        </div>
      </div>

      <!-- Step 7: Additional Mobile Features -->
      <div
        class="step-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200"
      >
        <div
          class="flex flex-col lg:flex-row items-start space-y-4 lg:space-y-0 lg:space-x-6 lg:space-x-reverse"
        >
          <div class="flex-1">
            <div class="flex items-center space-x-3 space-x-reverse mb-4">
              <span
                class="bg-indigo-500 text-white px-3 py-1 rounded-full text-sm font-bold"
                >مرحله ۷</span
              >
              <h2 class="text-2xl font-bold text-gray-800">چاپ حواله بار</h2>
            </div>
            <p class="text-gray-600 mb-4 leading-relaxed">
              در نهایت پس از رسیدن راننده ,اپراتور باربری او را تایید کرده و
              برای او حواله را چاپ می کند
            </p>
          </div>
          <div class="flex-shrink-0 w-full lg:w-auto">
            <img
              src="./images/step_7_1.PNG"
              alt=" چاپ حواله"
              class="image-container main-image w-full"
              loading="lazy"
              onclick="openStepModal(7, 0)"
            />
          </div>
        </div>
      </div>
    </main>

    <!-- Zoom Controls -->
    <div class="zoom-controls no-print">
      <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
      <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">−</button>
      <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">
        ↺
      </button>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
      <div class="modal-overlay" onclick="closeModal()"></div>

      <!-- Close Button - Fixed positioning and display -->
      <button class="modal-close" onclick="closeModal()" title="بستن">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M18 6L6 18M6 6L18 18"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>

      <!-- Image Counter -->
      <div class="modal-counter" id="imageCounter"></div>

      <!-- Navigation Buttons - Fixed directions and positioning -->
      <button
        class="modal-nav modal-prev"
        onclick="previousImage()"
        id="prevBtn"
        title="تصویر قبلی"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M15 18L9 12L15 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>

      <button
        class="modal-nav modal-next"
        onclick="nextImage()"
        id="nextBtn"
        title="تصویر بعدی"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M9 18L15 12L9 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>

      <!-- Main Image -->
      <img
        class="modal-image"
        id="modalImage"
        alt="تصویر"
        onclick="event.stopPropagation()"
      />

      <!-- Image Info -->
      <div class="modal-info" id="modalInfo"></div>
    </div>

    <script>
      let currentZoom = 1;
      const zoomStep = 0.2;
      const maxZoom = 3;
      const minZoom = 0.5;

      let currentStep = 1;
      let currentImageIndex = 0;
      let stepImages = {};

      // Define images for each step
      function initializeStepImages() {
        stepImages = {
          1: [{ src: "./images/step_1.PNG", alt: "صفحه اصلی سیستم" }],
          2: [{ src: "./images/step_2.PNG", alt: "فرم ورود به سیستم" }],
          3: [
            { src: "./images/step_3_1.PNG", alt: "فرم ثبت بار قسمت اول" },
            { src: "./images/step_3_2.PNG", alt: "فرم ثبت بار قسمت دوم" },
            { src: "./images/step_4_1.PNG", alt: "تاریخچه بارها" },
            { src: "./images/step_4_2.PNG", alt: "نحوه فعالسازی بار" }
          ],
          4: [{ src: "./images/step_5_1.jpg", alt: "پنل موبایل راننده" }],
          5: [
            { src: "./images/step_5_2.jpg", alt: "صفحه اعلام بارها" },
            {
              src: "./images/step_5_3.jpg",
              alt: "نتیجه ثبت بار درون صفحه اعلام‌بارها"
            },
            { src: "./images/step_5_2_1.jpg", alt: "دریافت پیامک موفقیت آمیز" },
            {
              src: "./images/step_5_4.jpg",
              alt: "مشاهده بار در تب سابقه بارها "
            }
          ],
          6: [
            {
              src: "./images/step_6_1.PNG",
              alt: "لیست راننده ها و انجام عملگر مناسب"
            }
          ],
          7: [{ src: "./images/step_7_1.PNG", alt: "چاپ حواله  " }]
        };
      }

      // Enhanced modal functions - Complete rewrite
      function openStepModal(stepNumber, imageIndex) {
        currentStep = stepNumber;
        currentImageIndex = imageIndex;

        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        const counter = document.getElementById("imageCounter");
        const info = document.getElementById("modalInfo");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        const images = stepImages[stepNumber];
        const currentImage = images[imageIndex];

        // Set image source and alt
        modalImg.src = currentImage.src;
        modalImg.alt = currentImage.alt;

        // Update counter
        counter.textContent = `${imageIndex + 1} از ${images.length}`;

        // Update info
        info.textContent = currentImage.alt;

        // Show/hide navigation buttons based on position
        if (prevBtn) {
          prevBtn.style.display = imageIndex > 0 ? "flex" : "none";
        }
        if (nextBtn) {
          nextBtn.style.display =
            imageIndex < images.length - 1 ? "flex" : "none";
        }

        // Show modal
        modal.style.display = "block";

        // Add touch support
        addModalTouchSupport();
      }

      // Navigate to previous image - Fixed logic
      function previousImage() {
        if (currentImageIndex > 0) {
          currentImageIndex--;
          openStepModal(currentStep, currentImageIndex);
        }
      }

      // Navigate to next image - Fixed logic
      function nextImage() {
        const images = stepImages[currentStep];
        if (currentImageIndex < images.length - 1) {
          currentImageIndex++;
          openStepModal(currentStep, currentImageIndex);
        }
      }

      // Close modal
      function closeModal() {
        const modal = document.getElementById("imageModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Enhanced touch support for mobile - Complete rewrite
      function addModalTouchSupport() {
        const modal = document.getElementById("imageModal");
        if (!modal) return;

        let startX = 0;
        let startY = 0;
        let isSwiping = false;
        let swipeThreshold = 50;

        // Remove existing listeners to prevent duplicates
        modal.removeEventListener("touchstart", handleTouchStart);
        modal.removeEventListener("touchmove", handleTouchMove);
        modal.removeEventListener("touchend", handleTouchEnd);

        function handleTouchStart(e) {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
          isSwiping = false;
        }

        function handleTouchMove(e) {
          if (isSwiping) return;

          const currentX = e.touches[0].clientX;
          const currentY = e.touches[0].clientY;
          const diffX = Math.abs(currentX - startX);
          const diffY = Math.abs(currentY - startY);

          // Start swiping if horizontal movement is significant
          if (diffX > 20 && diffX > diffY) {
            isSwiping = true;
          }
        }

        function handleTouchEnd(e) {
          if (!isSwiping) return;

          const endX = e.changedTouches[0].clientX;
          const endY = e.changedTouches[0].clientY;

          const diffX = startX - endX;
          const diffY = startY - endY;

          // Only handle horizontal swipes
          if (
            Math.abs(diffX) > Math.abs(diffY) &&
            Math.abs(diffX) > swipeThreshold
          ) {
            if (diffX > 0) {
              // Swipe left - go to next image
              nextImage();
            } else {
              // Swipe right - go to previous image
              previousImage();
            }
          }

          isSwiping = false;
        }

        // Add touch event listeners
        modal.addEventListener("touchstart", handleTouchStart, {
          passive: true
        });
        modal.addEventListener("touchmove", handleTouchMove, { passive: true });
        modal.addEventListener("touchend", handleTouchEnd, { passive: true });
      }

      // Initialize modal system
      function initializeModal() {
        // Initialize step images
        initializeStepImages();

        // Hide modal initially
        const modal = document.getElementById("imageModal");
        if (modal) {
          modal.style.display = "none";
        }

        // Add keyboard navigation
        document.addEventListener("keydown", function (e) {
          if (modal && modal.style.display === "block") {
            switch (e.key) {
              case "ArrowLeft":
                e.preventDefault();
                previousImage();
                break;
              case "ArrowRight":
                e.preventDefault();
                nextImage();
                break;
              case "Escape":
                e.preventDefault();
                closeModal();
                break;
            }
          }
        });
      }

      // Enhanced zoom functions with mobile support
      function zoomIn() {
        if (currentZoom < maxZoom) {
          currentZoom += zoomStep;
          applyZoom();
        }
      }

      function zoomOut() {
        if (currentZoom > minZoom) {
          currentZoom -= zoomStep;
          applyZoom();
        }
      }

      function resetZoom() {
        currentZoom = 1;
        applyZoom();
      }

      function applyZoom() {
        document.body.style.transform = `scale(${currentZoom})`;
        document.body.style.transformOrigin = "top center";
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        initializeModal();
      });

      // Add responsive design for mobile-friendliness
      const mediaQuery = window.matchMedia("(max-width: 768px)");
      function handleMobileView(e) {
        if (e.matches) {
          document.body.classList.add("mobile-view");
        } else {
          document.body.classList.remove("mobile-view");
        }
      }
      mediaQuery.addListener(handleMobileView);
      handleMobileView(mediaQuery);

      // Enhanced keyboard navigation with mobile considerations
      document.addEventListener("keydown", function (e) {
        // Zoom with keyboard
        if (e.ctrlKey || e.metaKey) {
          if (e.key === "=" || e.key === "+") {
            e.preventDefault();
            zoomIn();
          } else if (e.key === "-") {
            e.preventDefault();
            zoomOut();
          } else if (e.key === "0") {
            e.preventDefault();
            resetZoom();
          }
        }
      });

      // Close modal with Escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeModal();
        }
      });

      // Add mobile-specific optimizations
      function optimizeForMobile() {
        const isMobile = window.innerWidth <= 768;

        if (isMobile) {
          // Optimize images for mobile
          const images = document.querySelectorAll(".image-container");
          images.forEach(img => {
            img.style.maxWidth = "100%";
            img.style.height = "auto";
          });

          // Adjust step cards for mobile
          const stepCards = document.querySelectorAll(".step-card");
          stepCards.forEach(card => {
            card.style.marginBottom = "1rem";
          });
        }
      }

      // Call optimization on load and resize
      window.addEventListener("load", function () {
        optimizeForMobile();
      });
      window.addEventListener("resize", optimizeForMobile);
    </script>
  </body>
</html>
